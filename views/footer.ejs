  </main>
  <button class="scroll-top" id="scroll-top" aria-label="חזרה למעלה">&#8593;</button>
  <footer>
    <div class="footer-bottom">
      <p>דוֹשי | AI לעסקים &copy; <%= new Date().getFullYear() %></p>
    </div>
  </footer>
  <script>
    // Theme
    function getTheme() {
      return localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    }
    function applyTheme(t) {
      document.documentElement.setAttribute('data-theme', t);
      localStorage.setItem('theme', t);
      var hljsLink = document.getElementById('hljs-theme');
      hljsLink.href = t === 'dark'
        ? 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.0/styles/github-dark.min.css'
        : 'https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.0/styles/github.min.css';
    }
    function toggleTheme() {
      applyTheme(getTheme() === 'dark' ? 'light' : 'dark');
    }
    applyTheme(getTheme());

    // Mermaid — conditional load
    var mermaidBlocks = document.querySelectorAll('code[class*="language-mermaid"]');
    if (mermaidBlocks.length) {
      var s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js';
      s.onload = function() {
        mermaid.initialize({ startOnLoad: false, theme: getTheme() === 'dark' ? 'dark' : 'default' });
        mermaidBlocks.forEach(function(el) {
          var pre = el.parentElement;
          var div = document.createElement('div');
          div.className = 'mermaid';
          div.textContent = el.textContent;
          pre.replaceWith(div);
        });
        mermaid.run();
      };
      document.body.appendChild(s);
    }

    // Scroll to top
    var scrollBtn = document.getElementById('scroll-top');
    if (scrollBtn) {
      window.addEventListener('scroll', function() {
        scrollBtn.classList.toggle('visible', window.scrollY > 400);
      });
      scrollBtn.addEventListener('click', function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    }

    // Tag search & filter
    var tagSearch = document.getElementById('tag-search');
    var tagsList = document.getElementById('tags-list');
    if (tagSearch && tagsList) {
      var tagBtns = tagsList.querySelectorAll('.tag-btn');
      tagSearch.addEventListener('input', function() {
        var q = this.value.toLowerCase();
        tagBtns.forEach(function(btn) {
          btn.style.display = btn.textContent.toLowerCase().includes(q) ? '' : 'none';
        });
      });
      tagBtns.forEach(function(btn) {
        btn.addEventListener('click', function() {
          var tag = this.dataset.tag;
          var cards = document.querySelectorAll('.card, .featured-card');
          var active = this.classList.toggle('active');
          tagBtns.forEach(function(b) { if (b !== btn) b.classList.remove('active'); });
          cards.forEach(function(card) {
            if (!active) { card.style.display = ''; return; }
            var text = card.textContent;
            card.style.display = text.includes(tag) ? '' : 'none';
          });
        });
      });
    }

    // Copy page URL
    function copyPageUrl(btn) {
      navigator.clipboard.writeText(window.location.href).then(function() {
        btn.classList.add('copied');
        setTimeout(function() { btn.classList.remove('copied'); }, 2000);
      });
    }

    // Copy buttons
    document.querySelectorAll('.post-content pre').forEach(function(pre) {
      var btn = document.createElement('button');
      btn.className = 'copy-btn';
      btn.textContent = 'העתק';
      btn.addEventListener('click', function() {
        var code = pre.querySelector('code');
        navigator.clipboard.writeText(code.textContent).then(function() {
          btn.textContent = 'הועתק!';
          setTimeout(function() { btn.textContent = 'העתק'; }, 2000);
        });
      });
      pre.style.position = 'relative';
      pre.appendChild(btn);
    });

    // GA4 Custom Events

    // 1. Track clicks on technology/tool badges
    document.querySelectorAll('.tool-badge, .badge-tag, .tag-btn').forEach(function(tag) {
      tag.addEventListener('click', function() {
        gtag('event', 'select_content', {
          'content_type': 'technology_tag',
          'item_id': this.innerText.trim()
        });
      });
    });

    // 2. Track scroll depth milestones (25%, 50%, 75%, 100%)
    var scrollMilestones = [25, 50, 75, 100];
    var milestonesReached = {};
    window.addEventListener('scroll', function() {
      var scrollPercent = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
      scrollMilestones.forEach(function(m) {
        if (scrollPercent >= m && !milestonesReached[m]) {
          milestonesReached[m] = true;
          gtag('event', 'article_depth', {
            'percentage': m,
            'page_title': document.title
          });
        }
      });
    });

    // 3. Track outbound tool/affiliate link clicks
    document.querySelectorAll('a').forEach(function(link) {
      if (link.hostname && link.hostname !== window.location.hostname) {
        link.addEventListener('click', function() {
          gtag('event', 'outbound_tool_click', {
            'destination': this.href,
            'tool_name': this.innerText.trim() || this.hostname
          });
        });
      }
    });

    // 4. Track code copy events
    document.querySelectorAll('.copy-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        gtag('event', 'copy_code', {
          'page_title': document.title
        });
      });
    });
  </script>
</body>
</html>
